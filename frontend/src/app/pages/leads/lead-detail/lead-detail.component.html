<div class="lead-detail">
  <div class="lead-form">
    <h3>{{ isEditMode ? 'Edit Lead' : 'New Lead' }}</h3>

    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="row">
        <mat-form-field appearance="outline"
          ><mat-label>First name</mat-label><input matInput formControlName="firstName"
        /></mat-form-field>
        <mat-form-field appearance="outline"
          ><mat-label>Last name</mat-label><input matInput formControlName="lastName"
        /></mat-form-field>
      </div>

      <mat-form-field appearance="outline" class="full"
        ><mat-label>Email</mat-label><input matInput formControlName="email"
      /></mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Source</mat-label>
        <mat-select formControlName="source">
          <mat-option *ngFor="let s of leadSources" [value]="s.value">{{ s.label }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Status</mat-label>
        <mat-select formControlName="status">
          <mat-option *ngFor="let s of leadStatuses" [value]="s.value">{{ s.label }}</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="actions">
        <button mat-button type="button" (click)="close()">Cancel</button>
        <button mat-flat-button color="primary" type="submit" [disabled]="isSubmitting">
          {{ isEditMode ? 'Save' : 'Create' }}
        </button>
      </div>
    </form>
  </div>

  <hr />

  <div class="lead-tasks">
    <div style="display: flex; justify-content: space-between; align-items: center">
      <h4>Tasks</h4>
      <button mat-flat-button color="primary" (click)="openAddTask()">+ Add Task</button>
    </div>

    <div *ngIf="tasksLoading">Loading tasks...</div>

    <div *ngIf="!tasksLoading && tasks.length === 0" class="empty">No tasks for this lead.</div>

    <div *ngIf="!tasksLoading && tasks.length > 0" class="tasks-list">
      <div
        *ngFor="let t of tasks"
        class="task-row"
        style="padding: 8px; border-bottom: 1px solid #eee"
      >
        <div style="display: flex; justify-content: space-between; align-items: center">
          <div>
            <div style="font-weight: 600">{{ t.title }}</div>
            <div style="font-size: 12px; color: #666">
              {{ t.dueDate | date : 'shortDate' }} â€¢ {{ t.priority }}
            </div>
          </div>
          <div>
            <button mat-icon-button (click)="editTask(t)"><mat-icon>edit</mat-icon></button>
          </div>
        </div>
      </div>
    </div>

    <div
      *ngIf="showTaskForm"
      style="margin-top: 12px; background: #fff; padding: 12px; border-radius: 8px"
    >
      <app-task-form
        [task]="editingTask"
        [leadId]="leadId"
        (saved)="onTaskSaved($event)"
        (cancelled)="onTaskCancelled()"
      ></app-task-form>
    </div>
  </div>
</div>
